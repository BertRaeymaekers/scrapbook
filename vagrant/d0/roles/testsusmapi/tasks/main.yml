---

- name: Put a test file in it
  become: yes
  become_user: "{{wsgi_user}}"
  copy:
    src: "../files/dummy_wsgi.py"
    dest: "~{{wsgi_user}}/wsgi.py"
    owner: "{{wsgi_user}}"
    group: "{{wsgi_user}}"
    mode: u=rwx,g=r,o=r

- name: Put a uwsgi ini file in it
  become: yes
  become_user: "{{wsgi_user}}"
  copy:
    src: "../files/dummy_susmapi.ini"
    dest: "~{{wsgi_user}}/susmapi.ini"
    owner: "{{wsgi_user}}"
    group: "{{wsgi_user}}"
    mode: u=rw,g=r,o=r

- name: Put the /etc/init/susmapi.service
  become: yes
  copy:
    src: "../files/susmapi.service"
    dest: "/lib/systemd/system/susmapi.service"
    owner: "{{wsgi_user}}"
    group: "{{wsgi_user}}"
    mode: u=rw,g=r,o=r
# systemctl enable susmapi.service
# systemctl start susmapi

- name: Include in nginx
  become: yes
  copy:
    src: "../files/susmapi.nginx"
    dest: "/etc/nginx/sites-available/susmapi"
    owner: www-data
    group: www-data
    mode: u=rw,g=r,o=r

- name: Link to sites-enabled
  become: yes
  file:
    src: /etc/nginx/sites-available/susmapi
    dest: /etc/nginx/sites-enabled/susmapi
    state: link
  notify: nginx reload

- name: Remove the default nginx conf.
  become: yes
  file:
    path: /etc/nginx/sites-enabled/default
    state: absent
